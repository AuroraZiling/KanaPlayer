<UserControl
    x:Class="KanaPlayer.Views.Pages.SettingsView"
    x:DataType="pages:SettingsViewModel"
    xmlns="https://github.com/avaloniaui"
    xmlns:controls="clr-namespace:KanaPlayer.Controls"
    xmlns:converters="clr-namespace:KanaPlayer.Converters"
    xmlns:pages="clr-namespace:KanaPlayer.ViewModels.Pages"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:attaching="clr-namespace:KanaPlayer.Controls.Attaching">

    <UserControl.Resources>
        <converters:CloseBehaviorsToComboBoxIndexConverter x:Key="CloseBehaviorsToComboBoxIndexConverter" />
        <converters:StorageSizeHumanizerConverter x:Key="StorageSizeHumanizerConverter" />
    </UserControl.Resources>

    <UserControl.Styles>
        <Style Selector="TabControl">
            <Setter Property="Template">
                <ControlTemplate>
                    <Border BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="{TemplateBinding CornerRadius}"
                            Background="{TemplateBinding Background}"
                            HorizontalAlignment="{TemplateBinding HorizontalAlignment}"
                            VerticalAlignment="{TemplateBinding VerticalAlignment}"
                            TextElement.Foreground="LightGray">
                        <DockPanel>
                            <Panel DockPanel.Dock="{TemplateBinding TabStripPlacement}">
                                <StackPanel Orientation="Horizontal" Spacing="20">
                                    <TextBlock Text="设置" Classes="h1" VerticalAlignment="Center"></TextBlock>
                                    <Border CornerRadius="50" Background="{DynamicResource KanaAccentColor20}">
                                        <ItemsPresenter Name="PART_ItemsPresenter"
                                                        ItemsPanel="{TemplateBinding ItemsPanel}" />
                                    </Border>
                                </StackPanel>
                            </Panel>
                            <ContentPresenter Name="PART_SelectedContentHost"
                                              Margin="0, 20, 0, 0"
                                              HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                                              Content="{TemplateBinding SelectedContent}"
                                              ContentTemplate="{TemplateBinding SelectedContentTemplate}" />
                        </DockPanel>
                    </Border>
                </ControlTemplate>
            </Setter>
        </Style>

        <Style Selector="TabItem">
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <ControlTemplate>
                    <Border CornerRadius="50" Padding="20, -2" Background="Transparent">
                        <TextBlock FontSize="18" Text="{TemplateBinding Header}" VerticalAlignment="Center"
                                   HorizontalAlignment="Center" />
                    </Border>
                </ControlTemplate>
            </Setter>
            <Style Selector="^:pointerover /template/ Border">
                <Setter Property="Background">
                    <SolidColorBrush Color="{DynamicResource KanaAccentColor}" Opacity="0.1" />
                </Setter>
            </Style>
            <Style Selector="^:selected /template/ Border">
                <Setter Property="Background">
                    <SolidColorBrush Color="{DynamicResource KanaAccentColor}" Opacity="0.2" />
                </Setter>
            </Style>
        </Style>
    </UserControl.Styles>

    <TabControl>
        <TabItem Header="常规">
            <ScrollViewer>
                <StackPanel Spacing="15">
                    <controls:KanaSettingsGroup Header="播放器">
                        <StackPanel Spacing="5">
                            <TextBlock Text="关闭按钮行为" Classes="h6"></TextBlock>
                            <TextBlock Text="选择按下主窗口关闭按钮后的行为"></TextBlock>
                            <ComboBox
                                Cursor="Hand"
                                Width="300"
                                SelectedIndex="{Binding SelectedCloseBehavior, Mode=TwoWay, Converter={StaticResource CloseBehaviorsToComboBoxIndexConverter}}"
                                VerticalAlignment="Center">
                                <ComboBoxItem Content="最小化至任务栏" />
                                <ComboBoxItem Content="隐藏至托盘菜单" />
                                <ComboBoxItem Content="关闭" />
                            </ComboBox>
                        </StackPanel>
                    </controls:KanaSettingsGroup>
                </StackPanel>
            </ScrollViewer>
        </TabItem>
        <TabItem Header="缓存">
            <ScrollViewer>
                <StackPanel Spacing="20">
                    <controls:KanaSettingsGroup Header="音频">
                        <StackPanel Spacing="5">
                            <TextBlock Text="缓存最大占用" Classes="h6"></TextBlock>
                            <TextBlock Text="音频缓存文件夹的最大空间占用，到达该占用后会自动清空到设定大小"></TextBlock>
                            <StackPanel Orientation="Horizontal" Margin="0, -10, 0, 0" Spacing="20">
                                <Slider Cursor="Hand" Width="500"
                                        Value="{Binding MaximumAudioCacheSizeInMb, Mode=TwoWay}" Minimum="256"
                                        Maximum="10240" TickFrequency="256" IsSnapToTickEnabled="True" />
                                <TextBlock Width="70" FontSize="16" VerticalAlignment="Center"
                                           Text="{Binding MaximumAudioCacheSizeInMb, Converter={StaticResource StorageSizeHumanizerConverter}}" />
                            </StackPanel>
                        </StackPanel>
                        <StackPanel Spacing="5">
                            <TextBlock Text="手动清空" Classes="h6"></TextBlock>
                            <TextBlock Text="将缓存文件夹彻底清空"></TextBlock>
                            <Button attaching:Icon.LucideIconKind="Trash" Content="清空音频文件夹" Command="{Binding CleanupCacheCommand}" CommandParameter="audio"/>
                        </StackPanel>
                    </controls:KanaSettingsGroup>
                    <controls:KanaSettingsGroup Header="图片">
                        <StackPanel Spacing="5">
                            <TextBlock Text="缓存最大占用" Classes="h6"></TextBlock>
                            <TextBlock Text="图片缓存文件夹的最大空间占用，到达该占用后会自动清空到设定大小"></TextBlock>
                            <StackPanel Orientation="Horizontal" Margin="0, -10, 0, 0" Spacing="20">
                                <Slider Cursor="Hand" Width="500"
                                        Value="{Binding MaximumImageCacheSizeInMb, Mode=TwoWay}" Minimum="128"
                                        Maximum="5120" TickFrequency="128" IsSnapToTickEnabled="True" />
                                <TextBlock Width="70" FontSize="16" VerticalAlignment="Center"
                                           Text="{Binding MaximumImageCacheSizeInMb, Converter={StaticResource StorageSizeHumanizerConverter}}" />
                            </StackPanel>
                        </StackPanel>
                        <StackPanel Spacing="5">
                            <TextBlock Text="手动清空" Classes="h6"></TextBlock>
                            <TextBlock Text="将缓存文件夹彻底清空"></TextBlock>
                            <Button attaching:Icon.LucideIconKind="Trash" Content="清空图片文件夹" Command="{Binding CleanupCacheCommand}" CommandParameter="image"/>
                        </StackPanel>
                    </controls:KanaSettingsGroup>
                </StackPanel>
            </ScrollViewer>
        </TabItem>
    </TabControl>
</UserControl>